<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Discover detailed information about [Tool Name] - a leading SaaS tool for [Category]. Features, pricing, pros, cons, and more.">
    <meta name="keywords" content="[Tool Name], SaaS tool, [Category], software, review, features, pricing">
    <title>Loading Tool Details... - SaaS Tools Directory</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-gray-100 font-sans leading-normal tracking-normal">

    <div id="cookieBanner" class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 text-center z-50 hidden">
        <p class="text-sm">We use cookies to ensure you get the best experience on our website. By continuing to use our site, you agree to our <a href="/privacy.html" class="underline">Privacy Policy</a>.</p>
        <button id="acceptCookies" class="mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white text-sm">Accept Cookies</button>
    </div>

    <header class="bg-white dark:bg-gray-800 shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="text-2xl font-bold text-gray-800 dark:text-white">SaaS Directory</a>
            <nav class="flex items-center space-x-6">
                <a href="/" class="text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Home</a>
                <a href="/blog.html" class="text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Blog</a>
                <a href="/submit-tool.html" class="text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Submit Tool</a>
                <a href="/faq.html" class="text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">FAQ</a>
                <a href="/admin.html" id="adminLink" class="text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400" style="display:none;">Admin</a>
                
                <label for="darkModeToggle" class="flex items-center cursor-pointer">
                    <div class="relative">
                        <input type="checkbox" id="darkModeToggle" class="sr-only">
                        <div class="block bg-gray-600 w-10 h-6 rounded-full"></div>
                        <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div>
                    </div>
                    <div class="ml-3 text-gray-700 font-medium dark:text-gray-300">Dark Mode</div>
                </label>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8 min-h-screen">
        <div id="loading" class="text-center text-xl font-semibold text-gray-700 dark:text-gray-300 mt-16">
            <i class="fas fa-spinner fa-spin mr-2"></i> Loading tool details...
        </div>

        <div id="toolDetail" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
            <div class="flex flex-col md:flex-row items-center md:items-start mb-8">
                <div class="md:w-1/4 flex justify-center md:justify-start mb-6 md:mb-0">
                    <img id="toolLogo" src="" alt="Tool Logo" class="w-32 h-32 object-contain rounded-lg border border-gray-200 dark:border-gray-700 p-2">
                </div>
                <div class="md:w-3/4 text-center md:text-left">
                    <h1 id="toolName" class="text-4xl md:text-5xl font-extrabold text-gray-800 dark:text-white mb-2"></h1>
                    <p id="toolCategory" class="text-lg text-blue-600 dark:text-blue-400 font-semibold mb-4"></p>
                    <p id="toolDescription" class="text-gray-700 dark:text-gray-300 text-lg mb-6"></p>
                    <a id="toolUrl" href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300">
                        Visit Website <i class="fas fa-external-link-alt ml-2"></i>
                    </a>
                </div>
            </div>

            <div id="fullDescriptionSection" class="mb-8 hidden">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Detailed Overview</h2>
                <div id="toolFullDescription" class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300">
                    </div>
            </div>

            <div id="featuresSection" class="mb-8 hidden">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Key Features</h2>
                <ul id="toolFeatures" class="list-disc list-inside space-y-2 text-gray-700 dark:text-gray-300 pl-4">
                    </ul>
            </div>

            <div id="pricingSection" class="mb-8 hidden">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Pricing</h2>
                <p id="toolPricingModel" class="text-gray-700 dark:text-gray-300 mb-2"></p>
                <p id="toolPricingDetails" class="text-gray-600 dark:text-gray-400 text-sm italic"></p>
            </div>

            <div id="platformsSection" class="mb-8 hidden">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Available Platforms</h2>
                <p id="toolPlatforms" class="text-gray-700 dark:text-gray-300"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div id="prosSection" class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-inner hidden">
                    <h3 class="text-xl font-semibold text-green-600 dark:text-green-400 mb-3"><i class="fas fa-check-circle mr-2"></i> Pros</h3>
                    <ul id="toolPros" class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200">
                        </ul>
                </div>
                <div id="consSection" class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-inner hidden">
                    <h3 class="text-xl font-semibold text-red-600 dark:text-red-400 mb-3"><i class="fas fa-times-circle mr-2"></i> Cons</h3>
                    <ul id="toolCons" class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200">
                        </ul>
                </div>
            </div>
            
        </div>

        <div id="notFound" class="hidden text-center mt-16">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">Tool Not Found</h2>
            <p class="text-gray-700 dark:text-gray-300 mb-6">The SaaS tool you are looking for does not exist or has been removed.</p>
            <a href="/" class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300">Go to Homepage</a>
        </div>
    </main>

    <footer class="bg-gray-800 dark:bg-gray-900 text-white py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <div class="flex flex-wrap justify-center gap-8 mb-6">
                <a href="/about.html" class="hover:text-blue-400">About Us</a>
                <a href="/privacy.html" class="hover:text-blue-400">Privacy Policy</a>
                <a href="/terms.html" class="hover:text-blue-400">Terms of Service</a>
                <a href="/contact.html" class="hover:text-blue-400">Contact</a>
                <a href="https://github.com/your-username/your-repo-name" target="_blank" class="hover:text-blue-400"><i class="fab fa-github"></i> GitHub</a>
            </div>
            <p>&copy; 2024 SaaS Tools Directory. All rights reserved.</p>
        </div>
    </footer>

    <script src="firebase-config.js"></script>
    <script src="firestore.js"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script src="seo-meta.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            setSeoMetaData('tool-detail', "Loading Tool Details...", "Discover detailed information about a SaaS tool.", "SaaS tool, software, review"); // Initial SEO

            const loadingEl = document.getElementById('loading');
            const toolDetailEl = document.getElementById('toolDetail');
            const notFoundEl = document.getElementById('notFound');

            const toolLogoEl = document.getElementById('toolLogo');
            const toolNameEl = document.getElementById('toolName');
            const toolCategoryEl = document.getElementById('toolCategory');
            const toolDescriptionEl = document.getElementById('toolDescription');
            const toolUrlEl = document.getElementById('toolUrl');

            const fullDescriptionSection = document.getElementById('fullDescriptionSection');
            const toolFullDescriptionEl = document.getElementById('toolFullDescription');
            
            const featuresSection = document.getElementById('featuresSection');
            const toolFeaturesList = document.getElementById('toolFeatures');

            const pricingSection = document.getElementById('pricingSection');
            const toolPricingModelEl = document.getElementById('toolPricingModel');
            const toolPricingDetailsEl = document.getElementById('toolPricingDetails');

            const platformsSection = document.getElementById('platformsSection');
            const toolPlatformsEl = document.getElementById('toolPlatforms');

            const prosSection = document.getElementById('prosSection');
            const toolProsList = document.getElementById('toolPros');
            const consSection = document.getElementById('consSection');
            const toolConsList = document.getElementById('toolCons');

            // Function to get query parameter by name
            function getQueryParam(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            // Get the tool slug from the URL (e.g., ?slug=figma)
            const toolSlug = getQueryParam('slug');

            if (!toolSlug) {
                loadingEl.classList.add('hidden');
                toolDetailEl.classList.add('hidden');
                notFoundEl.classList.remove('hidden');
                setSeoMetaData('tool-not-found', "Tool Not Found - SaaS Tools Directory", "The requested SaaS tool could not be found.", "404, tool not found");
                return;
            }

            try {
                // Fetch the tool data from Firestore using the slug
                // We assume 'slug' field is unique for tools
                const tools = await getDocumentsByQuery('tools', [{ field: 'slug', operator: '==', value: toolSlug }]);

                if (tools.length === 0 || !tools[0].isApproved) {
                    loadingEl.classList.add('hidden');
                    toolDetailEl.classList.add('hidden');
                    notFoundEl.classList.remove('hidden');
                    setSeoMetaData('tool-not-found', "Tool Not Found - SaaS Tools Directory", "The requested SaaS tool could not be found.", "404, tool not found");
                    return;
                }

                const tool = tools[0]; // Assuming slug is unique, take the first result

                // Update page title and SEO
                document.title = `${tool.name} - SaaS Tools Directory`;
                setSeoMetaData(
                    `tool-detail-${tool.slug}`,
                    `${tool.name} - SaaS Tools Directory`,
                    tool.description || `Discover detailed information about ${tool.name}.`,
                    `${tool.name}, SaaS tool, ${tool.category || ''}, software, review, features, pricing`
                );

                // Populate tool details
                toolLogoEl.src = tool.logoUrl || '/placeholder-logo.png'; // Use a placeholder if no logo
                toolLogoEl.alt = `${tool.name} Logo`;
                toolNameEl.textContent = tool.name;
                toolCategoryEl.textContent = tool.category || 'Uncategorized';
                toolDescriptionEl.textContent = tool.description;
                toolUrlEl.href = tool.url;

                // Full Description
                if (tool.fullDescription) {
                    toolFullDescriptionEl.innerHTML = tool.fullDescription; // Assuming HTML content
                    fullDescriptionSection.classList.remove('hidden');
                }

                // Features
                if (tool.features && tool.features.length > 0) {
                    toolFeaturesList.innerHTML = tool.features.map(feature => `<li>${feature}</li>`).join('');
                    featuresSection.classList.remove('hidden');
                }

                // Pricing Model
                if (tool.pricingModel && tool.pricingModel.length > 0) {
                    toolPricingModelEl.textContent = `Pricing Model: ${tool.pricingModel.join(', ')}`;
                    pricingSection.classList.remove('hidden');
                }
                if (tool.pricingDetails) {
                    toolPricingDetailsEl.textContent = tool.pricingDetails;
                } else {
                    toolPricingDetailsEl.classList.add('hidden');
                }

                // Platforms
                if (tool.platforms && tool.platforms.length > 0) {
                    toolPlatformsEl.textContent = `Available on: ${tool.platforms.join(', ')}`;
                    platformsSection.classList.remove('hidden');
                }

                // Pros
                if (tool.pros && tool.pros.length > 0) {
                    toolProsList.innerHTML = tool.pros.map(item => `<li>${item}</li>`).join('');
                    prosSection.classList.remove('hidden');
                }

                // Cons
                if (tool.cons && tool.cons.length > 0) {
                    toolConsList.innerHTML = tool.cons.map(item => `<li>${item}</li>`).join('');
                    consSection.classList.remove('hidden');
                }

                // Increment views count in Firestore (consider Cloud Function for robust tracking)
                if (tool.id) {
                    // Update views for the specific tool
                    await updateDocument('tools', tool.id, {
                        views: firebase.firestore.FieldValue.increment(1)
                    });
                    // Also update total site views (if siteMetrics/overview exists)
                    await updateDocument('siteMetrics', 'overview', {
                        totalViews: firebase.firestore.FieldValue.increment(1)
                    });
                }

                // Event listener for the "Visit Website" button (to track clicks)
                toolUrlEl.addEventListener('click', async () => {
                    if (tool.id) {
                        await updateDocument('tools', tool.id, {
                            clicks: firebase.firestore.FieldValue.increment(1)
                        });
                        // Also update total site clicks
                        await updateDocument('siteMetrics', 'overview', {
                            totalClicks: firebase.firestore.FieldValue.increment(1)
                        });
                    }
                });


                loadingEl.classList.add('hidden');
                toolDetailEl.classList.remove('hidden');

            } catch (error) {
                console.error("Error fetching tool details:", error);
                loadingEl.classList.add('hidden');
                toolDetailEl.classList.add('hidden');
                notFoundEl.classList.remove('hidden');
                setSeoMetaData('tool-not-found', "Tool Not Found - SaaS Tools Directory", "An error occurred while loading the tool details.", "error, tool not found");
            }
        });
    </script>
</body>
                        </html>
